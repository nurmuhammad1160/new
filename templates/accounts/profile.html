{% extends 'base.html' %}
{% load static %}
{% load i18n %}

{% block title %}{% trans "Profil" %}{% endblock %}

{% block page_title %}{% trans "Mening profilim" %}{% endblock %}

{% block content %}

<div class="profile-container">
    <div class="profile-layout">
        <!-- Left Side - Avatar and Basic Info -->
        <div class="profile-sidebar">
            <div class="card">
                <div class="avatar-section">
                    {% if user.avatar %}
                        <img src="{{ user.avatar.url }}" alt="Avatar" class="profile-avatar">
                    {% else %}
                        <div class="profile-avatar-placeholder">
                            {{ user.first_name.0 }}{{ user.last_name.0 }}
                        </div>
                    {% endif %}
                    
                    <h3>{{ user.get_full_name }}</h3>
                    <p class="user-username">@{{ user.username }}</p>
                    <span class="role-badge role-{{ user.role }}">
                        {{ user.get_role_display }}
                    </span>
                </div>
                
                <div class="profile-stats">
                    <div class="stat-item">
                        <div class="stat-label">{% trans "Viloyat" %}</div>
                        <div class="stat-value">
                            {% if user.region %}
                                {{ user.region.name }}
                            {% else %}
                                <span class="text-muted">{% trans "Belgilanmagan" %}</span>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="stat-item">
                        <div class="stat-label">{% trans "Lavozim" %}</div>
                        <div class="stat-value">
                            {% if user.position %}
                                {{ user.position }}
                            {% else %}
                                <span class="text-muted">{% trans "Belgilanmagan" %}</span>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="stat-item">
                        <div class="stat-label">{% trans "Ro'yxatdan o'tgan" %}</div>
                        <div class="stat-value">{{ user.date_joined|date:"d.m.Y" }}</div>
                    </div>
                </div>
                
                <div class="profile-actions">
                    <a href="{% url 'accounts:change_password' %}" class="btn btn-secondary btn-block">
                        üîí {% trans "Parolni o'zgartirish" %}
                    </a>
                </div>
            </div>
        </div>
        
        <!-- Right Side - Edit Form -->
        <div class="profile-main">
            <div class="card">
                <h3 class="card-title">{% trans "Profil ma'lumotlari" %}</h3>
                
                <form method="post" enctype="multipart/form-data" class="profile-form">
                    {% csrf_token %}
                    
                    <div class="form-section">
                        <h4 class="section-title">{% trans "Shaxsiy ma'lumotlar" %}</h4>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">{% trans "Familiya" %} *</label>
                                {{ form.last_name }}
                                {% if form.last_name.errors %}
                                    <span class="form-error">{{ form.last_name.errors.0 }}</span>
                                {% endif %}
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">{% trans "Ism" %} *</label>
                                {{ form.first_name }}
                                {% if form.first_name.errors %}
                                    <span class="form-error">{{ form.first_name.errors.0 }}</span>
                                {% endif %}
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">{% trans "Sharif" %}</label>
                            {{ form.middle_name }}
                            {% if form.middle_name.errors %}
                                <span class="form-error">{{ form.middle_name.errors.0 }}</span>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h4 class="section-title">{% trans "Tashkiliy ma'lumotlar" %}</h4>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">{% trans "Viloyat" %} *</label>
                                {{ form.region }}
                                {% if form.region.errors %}
                                    <span class="form-error">{{ form.region.errors.0 }}</span>
                                {% endif %}
                                {% if not user.region %}
                                    <small class="text-warning">‚ö†Ô∏è {% trans "Viloyat majburiy! Murojaat yaratish uchun viloyatni tanlang." %}</small>
                                {% endif %}
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">{% trans "Hududiy bo'lim" %}</label>
                                {{ form.department }}
                                {% if form.department.errors %}
                                    <span class="form-error">{{ form.department.errors.0 }}</span>
                                {% endif %}
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">{% trans "Lavozim" %}</label>
                            {{ form.position }}
                            {% if form.position.errors %}
                                <span class="form-error">{{ form.position.errors.0 }}</span>
                            {% endif %}
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">{% trans "Telefon" %}</label>
                            {{ form.phone }}
                            {% if form.phone.errors %}
                                <span class="form-error">{{ form.phone.errors.0 }}</span>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h4 class="section-title">{% trans "Sozlamalar" %}</h4>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">{% trans "Til" %}</label>
                                {{ form.language }}
                                {% if form.language.errors %}
                                    <span class="form-error">{{ form.language.errors.0 }}</span>
                                {% endif %}
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">{% trans "Avatar" %}</label>
                                {{ form.avatar }}
                                {% if form.avatar.errors %}
                                    <span class="form-error">{{ form.avatar.errors.0 }}</span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <a href="{% url 'tickets:dashboard' %}" class="btn btn-secondary">
                            {% trans "Bekor qilish" %}
                        </a>
                        <button type="submit" class="btn btn-primary">
                            üíæ {% trans "Saqlash" %}
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_css %}
<style>
.profile-container {
    max-width: 1200px;
    margin: 0 auto;
}

.profile-layout {
    display: grid;
    grid-template-columns: 350px 1fr;
    gap: 30px;
}

.profile-sidebar .card {
    text-align: center;
}

.avatar-section {
    padding: 30px 20px 20px;
    border-bottom: 1px solid var(--border-color);
}

.profile-avatar {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    object-fit: cover;
    margin-bottom: 15px;
    border: 4px solid var(--bg-primary);
}

.profile-avatar-placeholder {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    background: var(--accent-primary);
    color: white;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-size: 40px;
    font-weight: 700;
    margin-bottom: 15px;
    border: 4px solid var(--bg-primary);
}

.avatar-section h3 {
    font-size: 22px;
    margin-bottom: 5px;
}

.user-username {
    color: var(--text-secondary);
    font-size: 14px;
    margin-bottom: 10px;
}

.role-badge {
    display: inline-block;
    padding: 6px 16px;
    border-radius: 20px;
    font-size: 13px;
    font-weight: 600;
}

.role-user {
    background: rgba(59, 130, 246, 0.1);
    color: #3b82f6;
}

.role-technician {
    background: rgba(16, 185, 129, 0.1);
    color: #10b981;
}

.role-admin {
    background: rgba(245, 158, 11, 0.1);
    color: #f59e0b;
}

.role-superadmin {
    background: rgba(147, 51, 234, 0.1);
    color: #9333ea;
}

.profile-stats {
    padding: 20px;
}

.stat-item {
    padding: 12px 0;
    border-bottom: 1px solid var(--border-color);
}

.stat-item:last-child {
    border-bottom: none;
}

.stat-label {
    font-size: 12px;
    color: var(--text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 5px;
}

.stat-value {
    font-weight: 600;
    font-size: 15px;
}

.profile-actions {
    padding: 20px;
    border-top: 1px solid var(--border-color);
}

.profile-form {
    margin-top: 20px;
}

.form-section {
    margin-bottom: 30px;
    padding-bottom: 30px;
    border-bottom: 1px solid var(--border-color);
}

.form-section:last-of-type {
    border-bottom: none;
    margin-bottom: 0;
    padding-bottom: 0;
}

.section-title {
    font-size: 16px;
    font-weight: 600;
    margin-bottom: 20px;
    color: var(--text-primary);
}

.form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
}

.form-actions {
    display: flex;
    gap: 15px;
    justify-content: flex-end;
    margin-top: 30px;
    padding-top: 20px;
    border-top: 1px solid var(--border-color);
}

.text-warning {
    color: var(--accent-warning);
    font-size: 13px;
    display: block;
    margin-top: 5px;
}

@media (max-width: 1024px) {
    .profile-layout {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 768px) {
    .form-row {
        grid-template-columns: 1fr;
    }
}
</style>
{% endblock %}