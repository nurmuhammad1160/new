{% extends 'base.html' %}
{% load i18n %}

{% block title %}{% trans "Yangi foydalanuvchi" %}{% endblock %}

{% block page_title %}{% trans "Yangi foydalanuvchi yaratish" %}{% endblock %}

{% block content %}
<div class="form-container-wide">
    <div class="card">
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            
            <!-- Form Errors -->
            {% if form.errors %}
            <div class="alert alert-error" style="margin-bottom: 30px;">
                <strong>‚ùå {% trans "Xatoliklar:" %}</strong>
                <ul style="margin: 10px 0 0 20px;">
                    {% for field in form %}
                        {% for error in field.errors %}
                            <li>{{ field.label }}: {{ error }}</li>
                        {% endfor %}
                    {% endfor %}
                    {% for error in form.non_field_errors %}
                        <li>{{ error }}</li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}

            <!-- Personal Info Section -->
            <h3 class="section-title">üë§ {% trans "Shaxsiy ma'lumotlar" %}</h3>
            <div class="form-grid-2">
                <div class="form-group">
                    <label class="form-label">
                        {% trans "Familiya" %} <span style="color: var(--accent-danger);">*</span>
                    </label>
                    {{ form.last_name }}
                </div>
                <div class="form-group">
                    <label class="form-label">
                        {% trans "Ism" %} <span style="color: var(--accent-danger);">*</span>
                    </label>
                    {{ form.first_name }}
                </div>
                <div class="form-group">
                    <label class="form-label">{% trans "Otasining ismi" %}</label>
                    {{ form.middle_name }}
                </div>
                <div class="form-group">
                    <label class="form-label">{% trans "Telefon raqami" %}</label>
                    {{ form.phone_number }}
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">{% trans "Rasm" %}</label>
                {{ form.photo }}
                <small class="form-help">
                    {% trans "JPG, PNG formatida, max 2MB" %}
                </small>
            </div>

            <!-- Account Info Section -->
            <h3 class="section-title" style="margin-top: 30px;">üîê {% trans "Akkaunt ma'lumotlari" %}</h3>
            <div class="form-grid-2">
                <div class="form-group">
                    <label class="form-label">
                        {% trans "Username" %} <span style="color: var(--accent-danger);">*</span>
                    </label>
                    {{ form.username }}
                    <small class="form-help">
                        {% trans "Faqat harflar, raqamlar va _ @ + . - belgilar" %}
                    </small>
                </div>
                <div class="form-group">
                    <label class="form-label">
                        {% trans "Viloyat" %} <span style="color: var(--accent-danger);">*</span>
                    </label>
                    {{ form.region }}
                </div>
                <div class="form-group">
                    <label class="form-label">
                        {% trans "Parol" %} <span style="color: var(--accent-danger);">*</span>
                    </label>
                    {{ form.password1 }}
                    <small class="form-help">
                        {% trans "Kamida 6 belgidan iborat" %}
                    </small>
                </div>
                <div class="form-group">
                    <label class="form-label">
                        {% trans "Parolni tasdiqlash" %} <span style="color: var(--accent-danger);">*</span>
                    </label>
                    {{ form.password2 }}
                </div>
            </div>

            <!-- Role Section -->
            <h3 class="section-title" style="margin-top: 30px;">üõ°Ô∏è {% trans "Rol va huquqlar" %}</h3>
            <div class="form-group">
                <label class="form-label">
                    {% trans "Rol" %} <span style="color: var(--accent-danger);">*</span>
                </label>
                <select name="role" class="form-select" required>
                    <option value="user">{% trans "Foydalanuvchi" %}</option>
                    <option value="technician">{% trans "Texnik" %}</option>
                    <option value="admin">{% trans "Admin" %}</option>
                    <option value="superadmin">{% trans "Bosh Admin" %}</option>
                </select>
                <small class="form-help">
                    {% trans "Ehtiyotkorlik bilan tanlang! Rol foydalanuvchi huquqlarini belgilaydi." %}
                </small>
            </div>

            <!-- Role Descriptions -->
            <div class="info-box" style="margin-top: 20px;">
                <h4 style="margin: 0 0 15px 0;">‚ÑπÔ∏è {% trans "Rollar tavsifi:" %}</h4>
                <div class="role-descriptions">
                    <div class="role-item">
                        <strong>üë§ {% trans "Foydalanuvchi" %}:</strong>
                        <p>{% trans "Murojaat yaratish va o'z murojaatlarini ko'rish" %}</p>
                    </div>
                    <div class="role-item">
                        <strong>üîß {% trans "Texnik" %}:</strong>
                        <p>{% trans "O'ziga biriktirilgan murojaatlarni hal qilish" %}</p>
                    </div>
                    <div class="role-item">
                        <strong>üõ°Ô∏è {% trans "Admin" %}:</strong>
                        <p>{% trans "Barcha murojaatlar, tizimlar va foydalanuvchilarni boshqarish" %}</p>
                    </div>
                    <div class="role-item">
                        <strong>üëë {% trans "Bosh Admin" %}:</strong>
                        <p>{% trans "To'liq tizim nazorati, parollarni boshqarish, audit" %}</p>
                    </div>
                </div>
            </div>

            <!-- Buttons -->
            <div class="form-actions" style="margin-top: 30px;">
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    ‚úì {% trans "Yaratish" %}
                </button>
                <a href="{% url 'tickets:superadmin_users_list' %}" 
                   class="btn btn-secondary" style="width: 100%;">
                    ‚Üê {% trans "Bekor qilish" %}
                </a>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
.form-container-wide {
    max-width: 900px;
    margin: 0 auto;
}

.section-title {
    font-size: 18px;
    font-weight: 600;
    margin-bottom: 20px;
    padding-bottom: 10px;
    border-bottom: 2px solid var(--border-color);
}

.form-grid-2 {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 20px;
}

.form-help {
    display: block;
    font-size: 13px;
    color: var(--text-muted);
    margin-top: 5px;
}

.info-box {
    background: var(--bg-tertiary);
    padding: 20px;
    border-radius: var(--radius-sm);
}

.role-descriptions {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.role-item {
    padding: 12px;
    background: var(--bg-secondary);
    border-radius: var(--radius-sm);
    border-left: 3px solid var(--accent-primary);
}

.role-item strong {
    display: block;
    margin-bottom: 5px;
}

.role-item p {
    margin: 0;
    font-size: 14px;
    color: var(--text-secondary);
}

.form-actions {
    display: flex;
    flex-direction: column;
    gap: 10px;
    padding-top: 20px;
    border-top: 1px solid var(--border-color);
}

@media (max-width: 768px) {
    .form-container-wide {
        max-width: 100%;
    }
    
    .form-grid-2 {
        grid-template-columns: 1fr;
    }
}
</style>
{% endblock %}