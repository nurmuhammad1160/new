{% extends 'base.html' %}
{% load i18n %}

{% block title %}
    {% if action == 'create' %}
        {% trans "Yangi tizim" %}
    {% else %}
        {% trans "Tizimni tahrirlash" %}
    {% endif %}
{% endblock %}

{% block page_title %}
    {% if action == 'create' %}
        {% trans "Yangi tizim yaratish" %}
    {% else %}
        {% trans "Tizimni tahrirlash" %}
    {% endif %}
{% endblock %}

{% block content %}
<div class="form-container">
    <div class="form-header">
        <a href="{% url 'systems:systems_list' %}" class="btn btn-secondary">
            ← {% trans "Orqaga" %}
        </a>
    </div>

    <div class="card">
        <form method="post" class="main-form">
            {% csrf_token %}
            
            <!-- Form Errors -->
            {% if form.errors %}
            <div class="alert alert-error" style="margin-bottom: 20px;">
                <strong>❌ {% trans "Xatoliklar:" %}</strong>
                <ul style="margin: 10px 0 0 20px;">
                    {% for field in form %}
                        {% for error in field.errors %}
                            <li>{{ field.label }}: {{ error }}</li>
                        {% endfor %}
                    {% endfor %}
                </ul>
            </div>
            {% endif %}

            <!-- System Name -->
            <div class="form-group">
                <label class="form-label">
                    {% trans "Tizim nomi" %} <span style="color: var(--accent-danger);">*</span>
                </label>
                {{ form.name }}
                {% if form.name.help_text %}
                    <small class="form-help">{{ form.name.help_text }}</small>
                {% endif %}
            </div>

            <!-- Description -->
            <div class="form-group">
                <label class="form-label">
                    {% trans "Tavsif" %}
                </label>
                {{ form.description }}
                {% if form.description.help_text %}
                    <small class="form-help">{{ form.description.help_text }}</small>
                {% endif %}
            </div>

            <!-- Is Active -->
            <div class="form-group">
                <div class="checkbox-group">
                    {{ form.is_active }}
                    <label for="id_is_active" class="checkbox-label">
                        {% trans "Faol" %}
                    </label>
                </div>
                {% if form.is_active.help_text %}
                    <small class="form-help">{{ form.is_active.help_text }}</small>
                {% endif %}
            </div>

            <!-- Buttons -->
            <div class="form-actions">
                <button type="submit" class="btn btn-primary">
                    {% if action == 'create' %}
                        ✓ {% trans "Yaratish" %}
                    {% else %}
                        ✓ {% trans "Saqlash" %}
                    {% endif %}
                </button>
                <a href="{% url 'systems:systems_list' %}" class="btn btn-secondary">
                    ✕ {% trans "Bekor qilish" %}
                </a>
            </div>
        </form>
    </div>

    <!-- Info Card -->
    {% if action == 'edit' %}
    <div class="card" style="margin-top: 20px;">
        <h3 style="margin-bottom: 15px;">ℹ️ {% trans "Statistika" %}</h3>
        <div class="stats-mini">
            <div class="stat-mini">
                <strong>{{ system.tickets.count }}</strong>
                <span class="text-muted">{% trans "Murojaatlar" %}</span>
            </div>
            <div class="stat-mini">
                <strong>{{ system.responsibles.count }}</strong>
                <span class="text-muted">{% trans "Mas'ullar" %}</span>
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_css %}
<style>
.form-container {
    max-width: 800px;
    margin: 0 auto;
}

.form-header {
    margin-bottom: 20px;
}

.main-form {
    width: 100%;
}

.form-help {
    display: block;
    font-size: 13px;
    color: var(--text-muted);
    margin-top: 5px;
}

.checkbox-group {
    display: flex;
    align-items: center;
    gap: 10px;
}

.checkbox-group input[type="checkbox"] {
    width: 20px;
    height: 20px;
    cursor: pointer;
}

.checkbox-label {
    margin: 0;
    cursor: pointer;
    font-weight: 500;
}

.form-actions {
    display: flex;
    gap: 10px;
    margin-top: 30px;
    padding-top: 20px;
    border-top: 1px solid var(--border-color);
}

.stats-mini {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 20px;
}

.stat-mini {
    display: flex;
    flex-direction: column;
    gap: 5px;
}

.stat-mini strong {
    font-size: 24px;
    color: var(--text-primary);
}

@media (max-width: 768px) {
    .form-container {
        max-width: 100%;
    }
    
    .form-actions {
        flex-direction: column;
    }
    
    .form-actions .btn {
        width: 100%;
    }
}
</style>
{% endblock %}