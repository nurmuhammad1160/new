{% extends 'base.html' %}
{% load i18n %}

{% block title %}
    {% if action == 'create' %}
        {% trans "Mas'ul qo'shish" %}
    {% else %}
        {% trans "Mas'ulni tahrirlash" %}
    {% endif %}
{% endblock %}

{% block page_title %}
    {% if action == 'create' %}
        {% trans "Mas'ul qo'shish" %}
    {% else %}
        {% trans "Mas'ulni tahrirlash" %}
    {% endif %}
{% endblock %}

{% block content %}
<div class="form-container">
    <div class="form-header">
        <a href="{% url 'systems:system_responsibles' system.id %}" class="btn btn-secondary">
            ← {% trans "Orqaga" %}
        </a>
    </div>

    <div class="card">
        <form method="post">
            {% csrf_token %}
            
            <!-- Form Errors -->
            {% if form.errors %}
            <div class="alert alert-error" style="margin-bottom: 20px;">
                <strong>❌ {% trans "Xatoliklar:" %}</strong>
                <ul style="margin: 10px 0 0 20px;">
                    {% for field in form %}
                        {% for error in field.errors %}
                            <li>{{ field.label }}: {{ error }}</li>
                        {% endfor %}
                    {% endfor %}
                </ul>
            </div>
            {% endif %}

            <!-- System (hidden) -->
            {{ form.system }}

            <!-- User -->
            <div class="form-group">
                <label class="form-label">
                    {% trans "Foydalanuvchi" %} <span style="color: var(--accent-danger);">*</span>
                </label>
                {{ form.user }}
                <small class="form-help">
                    {% trans "Faqat admin yoki texnik rolga ega foydalanuvchilar" %}
                </small>
            </div>

            <!-- Role in System -->
            <div class="form-group">
                <label class="form-label">
                    {% trans "Tizim ichidagi rol" %} <span style="color: var(--accent-danger);">*</span>
                </label>
                {{ form.role_in_system }}
                <small class="form-help">
                    {% trans "Admin - barcha huquqlar, Texnik - faqat hal qilish" %}
                </small>
            </div>

            <!-- Region -->
            <div class="form-group">
                <label class="form-label">
                    {% trans "Viloyat" %}
                </label>
                {{ form.region }}
                <small class="form-help">
                    {% trans "Bo'sh qoldiring agar respublika miqyosida mas'ul bo'lsa (Default)" %}
                </small>
            </div>

            <!-- Is Default -->
            <div class="form-group">
                <div class="checkbox-group">
                    {{ form.is_default }}
                    <label for="id_is_default" class="checkbox-label">
                        {% trans "Default mas'ul (Respublika miqyosida)" %}
                    </label>
                </div>
                <small class="form-help">
                    {% trans "Viloyat bo'sh bo'lishi kerak agar default mas'ul belgilansa" %}
                </small>
            </div>

            <!-- Warning -->
            <div class="alert alert-info" style="margin-top: 20px;">
                ℹ️ <strong>{% trans "Eslatma:" %}</strong><br>
                {% trans "Viloyat va Default bir vaqtda tanlanishi mumkin emas!" %}
            </div>

            <!-- Buttons -->
            <div class="form-actions">
                <button type="submit" class="btn btn-primary">
                    {% if action == 'create' %}
                        ✓ {% trans "Qo'shish" %}
                    {% else %}
                        ✓ {% trans "Saqlash" %}
                    {% endif %}
                </button>
                <a href="{% url 'systems:system_responsibles' system.id %}" class="btn btn-secondary">
                    ✕ {% trans "Bekor qilish" %}
                </a>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
.form-container {
    max-width: 700px;
    margin: 0 auto;
}

.form-header {
    margin-bottom: 20px;
}

.form-help {
    display: block;
    font-size: 13px;
    color: var(--text-muted);
    margin-top: 5px;
}

.checkbox-group {
    display: flex;
    align-items: center;
    gap: 10px;
}

.checkbox-group input[type="checkbox"] {
    width: 20px;
    height: 20px;
    cursor: pointer;
}

.checkbox-label {
    margin: 0;
    cursor: pointer;
    font-weight: 500;
}

.form-actions {
    display: flex;
    gap: 10px;
    margin-top: 30px;
    padding-top: 20px;
    border-top: 1px solid var(--border-color);
}

@media (max-width: 768px) {
    .form-container {
        max-width: 100%;
    }
    
    .form-actions {
        flex-direction: column;
    }
    
    .form-actions .btn {
        width: 100%;
    }
}
</style>
{% endblock %}